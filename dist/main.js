!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);var i={GLYPH_OF_STORMS_FIRE:5736,GLYPH_OF_ELEMENTAL_POWER_FIRE:5739,PRIMORDIAL_STANCE:42086,PRIMORDIAL_STANCE_EFFECT:40183,ATTUNEMENT_FIRE_FIRE:43470,ATTUNEMENT_AIR_AIR:42264,ATTUNEMENT_EARTH_EARTH:44857,ARCANE_BLAST:5539,FLAME_UPRISING:45313,QUANTUM_STRIKE:43803,FIRE_GRAB:5557,ELEMENTS_OF_RAGE:42416,CONJURE_FIERY_GREATSWORD:5516,FIERY_GREATSWORD_FIRESTORM:5531,FIERY_GREATSWORD_FIERY_RUSH:5517,MAGNETIC_WAVE:15794,ASSASSINS_SIGNET_ACTIVE:44597,BOUNDING_DODGER:33162,FIST_FLURRY:30868,THE_PRESTIGE:10285,MAGIC_BULLET:10229,CRY_OF_FRUSTRATION:10190,AXES_OF_SYMMETRY:43761,IMAGINARY_AXES:44321,SIGNET_OF_THE_ETHER:21750,PHANTASMAL_BERSERKER:10221,PHANTASMAL_SWORDSMAN:10174,PHANTASMAL_DISENCHANTER:10267,PHANTASMAL_WARDEN:10282,WELL_OF_CALAMITY:30525,WELL_OF_RECALL:29856,WELL_OF_ACTION:30814,SIGNET_OF_INSPIRATION:10236,DODGE:65001,WEAPON_SWAP:-2,WEAVE_SELF:43638,ATTUNEMENT_AIR_WATER:"-12",ATTUNEMENT_AIR_FIRE:"-11",ATTUNEMENT_WATER_FIRE:"-8",ATTUNEMENT_FIRE_AIR:"-6",ATTUNEMENT_EARTH_AIR:"-16",ATTUNEMENT_EARTH_FIRE:"-14",ATTUNEMENT_WATER_EARTH:"-10",ATTUNEMENT_FIRE_EARTH:"-7",ATTUNEMENT_FIRE_WATER:"-5",CONJURE_LIGHTNING_HAMMER:5624,MANTRA_OF_POTENCE:40915,LEGENDARY_ASSASSIN_STANCE:27890,SUNDERING_LEAP:29613,THROW_BOLAS:14354,SWORD_OF_JUSTICE:9168,SWORD_OF_JUSTICE_ETERNAL_ARMORY:44846,ORB_OF_WRATH:9098,ZEALOTS_FIRE:9089,RENEWED_FOCUS:9154,SHARPENING_STONE:9963,ONE_WOLF_PACK:45717,FROST_TRAP:12492,SIC_EM:33902,TWICE_AS_VICIOUS:45600};function n(t,e){if(t.skillMap)for(const s in t.skillMap){const i=t.skillMap[s];i.id||(i.id=s.substr(1)),e.push(i)}if(t.buffMap)for(const s in t.buffMap){const i=t.buffMap[s];i.id||(i.id=s.substr(1)),e.push(i)}let s={},i={},n={},r=t.players.map((t,e)=>Object.assign({id:e},t)),o=!1;for(let e=0;e<t.players.length;e++){if(t.players[e].hasOwnProperty("details")){let{buffs:n,casts:l}=a(t.players[e].details);s[e]=n,i[e]=l}else{let{buffs:n,casts:a}=l(t.players[e]);o=!0,s[e]=n,i[e]=a}const r=t.players[e].targetDamage1S;r&&r[0]&&(n[e]=r[0][0])}let h={};for(let t of e)h[t.id]=t.name;let d=o?1:1e3;return{boss:t.fightName,players:r,start:t.phases[0].start*d,end:t.phases[0].end*d,skills:h,casts:i,buffs:s,targetDamage1S:n}}function a(t){let e={};for(let s of t.boonGraph[0]){e[s.id]=[];for(let t of s.states){let i=1e3*t[0];0===t[1]?e[s.id].push({Remove:i}):e[s.id].push({Apply:i})}}let s=[];for(let e of t.rotation)if(e[0])for(let e of t.rotation[0]){let t=1e3*e[0],i=e[1],n=e[2],a=e[3];e[4];s.push({id:i,start:t,end:t+n,fired:2!==a})}return{buffs:e,casts:s}}function l(t){let e={},s=[];for(let s of t.buffUptimes){e[s.id]=[];for(let t of s.states){let[i,n]=t;0===n?e[s.id].push({Remove:i}):e[s.id].push({Apply:i})}}for(let e of t.rotation){let t=e.id;for(let i of e.skills){let e=i.castTime,n=e+i.duration,a=i.duration+i.timeGained>0;s.push({id:t,start:e,end:n,fired:a})}}return{buffs:e,casts:s}}var r={parseJson:function(t){return n(t,[])},getJson:async function(t){const e=await fetch(`https://dps.report/getJson?permalink=${t}`),s=await e.json();if(!s.hasOwnProperty("error"))return n(s,[]);alert(`failed to fetch that log, message from dps.report: "${s.error}"`)}};var o=async function(t,e){const s=`./benchmarks/${t}.json`,i=await fetch(s),n=await i.json(),a=r.parseJson(n);if(a.casts=a.casts[0],a.buffs=a.buffs[0],a.targetDamage1S=a.targetDamage1S[0],"deadeye_rifle"===t)for(let t=0;t<a.targetDamage1S;t++)a.targetDamage1S[t]=38100*a.targetDamage1S[t]/40720;return a.id=t,e||(a.name=t.replace(/_/g," ")),a};const h=3,d=600;class c{constructor(){this.queue=[],this.currentCast=null,this.onKeyDown=this.onKeyDown.bind(this),this.update=this.update.bind(this),this.castDiv=document.getElementById("sh-cast"),this.queueDiv=document.getElementById("sh-queue"),document.body.addEventListener("keydown",this.onKeyDown)}onKeyDown(t){for(this.filterQueue();this.queue.length>=h;)this.queue.pop();this.queue.push({key:t.key,time:Date.now()})}filterQueue(){this.queue=this.queue.filter(t=>t.time+d>Date.now())}update(){(!this.currentCast||this.currentCast.end<=Date.now())&&(this.currentCast=null,this.cast()),this.draw(),window.requestAnimationFrame(this.update)}draw(){if(this.currentCast){let t=((this.currentCast.end-Date.now())/1e3).toFixed(2);this.castDiv.textContent=`${this.currentCast.key} ${t}s`}else this.castDiv.textContent="idle";this.queueDiv.textContent=JSON.stringify(this.queue.map(t=>t.key))}cast(){if(0===this.queue.length)return;let t=this.queue.shift(),e=400;SkillData[t.key]&&(e=SkillData[t.key].duration),this.currentCast={key:t.key,end:Date.now()+e}}}class u{constructor(){this.binds={1:"1",2:"2",3:"3",4:"4",5:"5","Glyph of Elemental Power (Fire)":"q","Primordial Stance":"e","Signet of Fire":"r","Weave Self":"b",Fire:"!",Water:"@",Air:"#",Earth:"$","Magnetic Wave":"4"};let t={"Glyph of Elemental Power (Fire)":"7","Signet of Fire":"8","Primordial Stance":"9","Weave Self":"0",Fire:"F1",Water:"F2",Air:"F3",Earth:"F4"};window.useNormalBinds&&(this.binds=Object.assign(this.binds,t))}get(t){return this.binds[t]}getAll(){return this.binds}getSlot(t){return Object.values(this.binds).indexOf(t)}}const E=!1;var f=new class{constructor(){this.loadSkill=this.loadSkill.bind(this),this.data={},E&&(this.failuresLog=document.createElement("div"),this.failuresLog.style.display="none",this.failuresLog.id="failures-log",document.body.appendChild(this.failuresLog))}load(t){return Promise.all(Object.keys(t).map(this.loadSkill))}async loadSkill(t){try{const e=await fetch(`api-cache/${t}.json`),s=await e.json();this.data[t]=s}catch(e){console.log("could not fetch",t),E&&(this.failuresLog.innerHTML+=`curl https://api.guildwars2.com/v2/skills/${t} > ${t}.json<br/>\n`)}}get(t){return this.data[t]}};class p{constructor(t){this.bench=t,this.binds=new u,this.castController=new c(this.binds),this.start=0,this.msPerPx=10,this.container=document.createElement("div"),this.container.classList.add("casts-container"),this.container.style.width=32*Object.keys(this.binds.getAll()).length+"px",document.body.appendChild(this.container),this.skillBar=document.createElement("div"),this.skillBar.classList.add("skill-bar"),this.skillBar.style.width=32*Object.keys(this.binds.getAll()).length+"px",document.body.appendChild(this.skillBar),this.update=this.update.bind(this)}slotToColor(t){let e=50;return 7===t&&(e=60),`hsl(${32*t%360},90%,${e}%)`}async load(){await f.load(this.bench.skills),console.log(this.bench),this.createTimeline(),this.createSkillBar()}createTimeline(){let t=this.buffApplyCasts(i.MAGNETIC_WAVE),e=this.buffApplyCasts(i.PRIMORDIAL_STANCE),s=this.buffApplyCasts(i.GLYPH_OF_ELEMENTAL_POWER_FIRE),n=this.attunementSwapCasts();this.bench.casts=this.bench.casts.concat(t,e,s,n);for(let t of this.bench.casts){let e=f.get(t.id);console.log(this.bench.skills[t.id]);let s=t.label||this.binds.get(this.bench.skills[t.id]);if(e&&e.slot){let t=e.slot.match(/(Weapon|Downed)_(\d)/);t&&t.length>0&&(s=t[2])}s||console.warn("noooo",this.bench.skills[t.id],t);let i=this.binds.getSlot(s),n=document.createElement("div");n.classList.add("cast-text"),n.textContent=s;let a=document.createElement("div");a.classList.add("cast"),a.appendChild(n),a.style.background=this.slotToColor(i),t.end-t.start<200&&(t.end=t.start+200);let l=(t.end-t.start)/this.msPerPx;a.style.height=l+"px";let r=32*i,o=-l-t.start/this.msPerPx;a.style.transform=`translate(${r}px,${o}px)`,this.container.appendChild(a)}}createSkillBar(){const t={};for(let e in this.binds.getAll()){const s=this.binds.get(e);if(t.hasOwnProperty(s))continue;t[s]=!0;let i=this.binds.getSlot(s),n=document.createElement("div");n.classList.add("cast-text"),n.textContent=s;let a=document.createElement("div");a.classList.add("cast"),a.appendChild(n),a.style.background=this.slotToColor(i),a.style.width="32px",a.style.height="24px";let l=32*i,r=0;a.style.transform=`translate(${l}px,${r}px)`,this.skillBar.appendChild(a)}}play(){this.start=Date.now()+1e3,this.update()}update(){let t=(Date.now()-this.start)/this.msPerPx;this.container.style.transform=`translate(-50%,${t}px)`,window.requestAnimationFrame(this.update)}attunementSwapCasts(){let t={};for(let e in this.bench.skills){let s=this.bench.skills[e];s.includes("Attunement")&&(t[e]=s)}let e=[];for(let s in t){let i=t[s].split(" ")[1],n=this.bench.buffs[s];for(let t of n)t.hasOwnProperty("Apply")&&e.push({label:this.binds.get(i),start:t.Apply,end:t.Apply})}return e}buffApplyCasts(t){let e=[],s=this.bench.buffs[t];for(let i of s){if(!i.hasOwnProperty("Apply"))continue;let s=this.binds.get(this.bench.skills[t]);e.push({label:s,start:i.Apply,end:i.Apply})}return e}}!async function(){let t=await o("weaver_condi_sword"),e=new p(t);await e.load(),e.play()}()}]);